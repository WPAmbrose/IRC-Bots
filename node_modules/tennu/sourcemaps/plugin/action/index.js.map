{"version":3,"sources":["/home/havvy/tennu/tennu/src/plugin/action/index.sjs"],"names":["inspect","require","format","chunk","Promise","module","exports","ActionPlugin","init","client","imports","raw","line","Array","isArray","join","info","String","_socket","rawf","apply","arguments","say","target","body","forEach","a","ctcp","type","act","notice","part","channel","reason","kick","nickname","nick","newNick","quit","note","mode","plus","minus","inArgs","args","util","userhost","users","map","hosts","Error","who","whois","server","length","users$2"],"mappings":"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","file":"action/index.js","sourcesContent":["const inspect = require('util').inspect;\nconst format = require('util').format;\nconst chunk = require('chunk');\nconst Promise = require('bluebird');\n\nmodule.exports = ActionPlugin = {\n    init: function (client, imports) {\n        function raw (line) {\n            if (Array.isArray(line)) { line = line.join(\" \"); }\n            client.info(\"->\", String(line));\n            client._socket.raw(line);\n        }\n\n        function rawf () {\n            raw(format.apply(null, arguments));\n        }\n\n\n        function say (target, body) {\n            if (Array.isArray(body)) {\n                body.forEach(λ[say(target, #)]);\n                return;\n            }\n\n            rawf(\"PRIVMSG %s :%s\", target, body);\n        }\n\n        function ctcp (target, type, body) {\n            if (Array.isArray(body)) {\n                body.forEach(λ[ctcp(target, type, #)]);\n                return;\n            }\n            \n            say(target, format('\\u0001%s %s\\u0001', type, body));\n        }\n\n        function act (target, body) {\n            ctcp(target, \"ACTION\", body);\n        }\n\n        function notice (target, body) {\n            if (Array.isArray(body)) {\n                body.forEach(λ[notice(target, #)]);\n                return;\n            }\n\n            rawf(\"NOTICE %s :%s\", target, body);\n        }\n\n        const join = require('./join')(client, rawf);\n\n\n        function part (channel, reason) {\n            raw(\"PART \" + channel + (reason ? \" :\" + reason: \"\"));\n        }\n\n        function kick (channel, nickname, reason) {\n            if (reason) {\n                rawf(\"KICK %s %s :%s\", channel, nickname, reason);\n            } else {\n                rawf(\"KICK %s %s\", channel, nickname);\n            }\n        }\n\n        function nick (newNick) {\n            rawf(\"NICK %s\", newNick);\n        }\n\n        function quit (reason) {\n            client.note(format(\"Quitting with reason: %s\", reason));\n            raw(\"QUIT\" + (reason ? \" :\" + reason : \"\"));\n        }\n\n        function mode (target, plus, minus, inArgs) {\n            var args = \" :\";\n\n            if (plus) {\n                args += \"+\" + plus;\n            }\n\n            if (minus) {\n                args += \"-\" + minus;\n            }\n\n            if (inArgs) {\n                args += \" \" + util.isArray(inArgs) ? inArgs.join(' ') : inArgs;\n            }\n\n            raw([\"MODE\", target, args]);\n        }\n\n        function userhost (users) {\n            if (typeof users === 'string') {\n                rawf(\"USERHOST:%s\", users);\n            } else if (typeof users === 'array') {\n                chunk(users, 5)\n                .map(function (hosts) { return hosts.join(' '); })\n                .map(userhost);\n            } else {\n                throw new Error(\"Userhost command takes either a string (a single nick) or an array (of string nicks)\");\n            }\n        }\n\n        function who (channel) {\n            raw([\"WHO\", channel]);\n        }\n\n        function whois (users, server) {\n            if (typeof users === \"array\") {\n                if (users.length > 15) {\n                    chunk(users, 15)\n                    .map(function (users) { return users.join(','); })\n                    .map(function (users) { whois(users, server); });\n                }\n            } else if (typeof users === 'string') {\n                raw(\"WHOIS \" + (server ? server + \" \" : \"\") + users);\n            } else {\n                throw new Error(\"Whois command takes either a string (a single nick) or an array (of string nicks)\");\n            }\n        }\n\n        /* To replace these functions...\n        const join = require('./join')(client, action_plugin);\n        const part = require('./part')(client, action_plugin);\n        const quit = require('./quit')(client, action_plugin);\n        const nick = require('./nick')(client, action_plugin);\n        const mode = require('./mode')(client, action_plugin);\n        const userhost = require('./userhost')(client, action_plugin);\n        const whois = require('./whois)(client, action_plugin);\n        const who = require('./who')(client, action_plugin);\n        */\n\n        return {\n            exports: {\n                raw: raw,\n                rawf: rawf,\n                say: say,\n                ctcp: ctcp,\n                act: act,\n                notice: notice,\n                join: join,\n                part: part,\n                kick: kick,\n                nick: nick,\n                quit: quit,\n                mode: mode,\n                userhost: userhost,\n                who: who,\n                whois: whois\n            }\n        };\n    }//,\n\n    //requires: \"server\";\n};"],"sourceRoot":"/source/"}